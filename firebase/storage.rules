
rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    
    // Allow anyone to read public images (e.g., marketplace listings, event banners)
    match /public/{allPaths=**} {
      allow read;
    }

    // Allow authenticated users to read and write to their own private folder.
    // This is useful for things like profile pictures, or private documents.
    match /users/{userId}/{allPaths=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Allow authenticated users to upload to shared folders like observations,
    // but not read everything in them to protect privacy.
    match /observations/{allPaths=**} {
        allow read: if request.auth != null; // Allow read for displaying images
        allow write: if request.auth != null;
    }

    match /agri-events/{userId}/{allPaths=**} {
       allow read; // Event images are public
       allow write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
